@{
    ViewData["Title"] = "Lista de Erros";
}

<h1 class="mt-3">Lista de Erros</h1>

<table id="error-table" class="table table-striped mt-3">
    <thead>
        <tr>
            <th scope="col">Erro</th>
            <th scope="col">Status</th>
            <th scope="col">Ações</th> 
        </tr>
    </thead>
    <tbody>
        <!-- Os dados da tabela serão inseridos aqui pelo JavaScript -->
    </tbody>
</table>

@section scripts {
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            let errosSelecionados = JSON.parse(localStorage.getItem("errosSelecionados"));

            if (errosSelecionados) {
                let errorTable = document.getElementById("error-table").getElementsByTagName("tbody")[0];

                errosSelecionados.forEach(function (erro) {
                    let newRow = errorTable.insertRow();
                    newRow.insertCell().appendChild(document.createTextNode(erro.id));
                    newRow.insertCell().appendChild(document.createTextNode(erro.status));

                    // Adiciona o botão de exclusão à nova coluna
                    let deleteButton = document.createElement("button");
                    deleteButton.textContent = "Excluir";
                    deleteButton.className = "btn btn-danger";
                    deleteButton.onclick = function () {
                        deleteRow(newRow);
                    };
                    newRow.insertCell().appendChild(deleteButton);
                });
            }
        });

        function deleteRow(row) {
            let rowIndex = row.rowIndex;
            document.getElementById("error-table").deleteRow(rowIndex);

            let id = row.cells[0].textContent; // Assume que a primeira célula contém o ID
            removeErrorFromLocalStorage(id);
        }

        function removeErrorFromLocalStorage(id) {
            let errosSelecionados = JSON.parse(localStorage.getItem("errosSelecionados"));

            let updatedErrors = errosSelecionados.filter(function (erro) {
                return erro.id !== id;
            });

            localStorage.setItem("errosSelecionados", JSON.stringify(updatedErrors));
        }
    </script>
}

<!-- Adicione o link para o Bootstrap JS no final do corpo do documento -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>